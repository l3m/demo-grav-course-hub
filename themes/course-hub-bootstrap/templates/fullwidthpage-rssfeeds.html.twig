{# new twig template file - hibbittsdesign.org #}
{% embed 'partials/base.html.twig' %}

  {% block content %}
    <div class="container">
      <div class="row">
        <div class="col-sm-12 blog-main">
          {% if not page.header.hide_page_title %}
          <h3>{{page.title}}</h3>
          {% else %}
          <h3 aria-label={{page.title}}></h3>
          {% endif %}

          {% if config.plugins.twigfeeds.enabled %}

            {% set index = 1 %}
            {% set feed_items = [] %}
            {% for name, feed in twig_feeds %}
                {% for item in feed.items %}
                    {% set index = index + 1 %}
                    {% set item = item|merge({ 'retrievedTitle': feed.title }) %}
                    {% set item = item|merge({ 'sortDate': item.date.date }) %}
                    {% set feed_items = feed_items|merge({ (index): (item) }) %}
                {% endfor %}
            {% endfor %}

            {{ page.content }}

            {% if page.header.rss_feed_display_order == 'source' %}
              {% for name, feed in twig_feeds %}
                  <h4><a class="newwindow external-link" href="{{ feed.source }}">{{ feed.title }}</a></h4>
                  {% for item in feed.items %}
                  <h5>
                  <a class="newwindow external-link" href="{{ item.url }}">{{ item.title }}</a>
                  </h5>
                  <time>{{ item.date.date|date("m/d/Y") }}</time>
                  {% if page.header.rss_feed_header_images and not (page.header.rss_feed_preview_paragraphs == 'all') %}
                    {% if grav.uri.param('chromeless') or (config.site.chromeless.enabled) %}
                        {% if not header.hide_rss_feed_header_images_when_chromeless %}
                          <p>{{ item.content|preg_get('/(<img(?:(\s*(class)\s*=\s*\x22([^\x22]+)\x22*)+|[^>]+?)*>)/') }}</p>
                        {% endif %}
                    {% else %}
                      <p>{{ item.content|preg_get('/(<img(?:(\s*(class)\s*=\s*\x22([^\x22]+)\x22*)+|[^>]+?)*>)/') }}</p>
                    {% endif %}
                  {% endif %}
                  {% set paragraphs = item.content | split('</p>') %}
                  {% set firstParagraph = paragraphs[0] ~ '</p>' %}
                  {% set secondParagraph = paragraphs[1] ~ '</p>' %}
                  {% if not (page.header.rss_feed_preview_paragraphs == 'none') %}
                    {% if page.header.rss_feed_preview_paragraphs == 'all' %}
                      {{ item.content }}
                    {% else %}
                      <p>{{ firstParagraph | striptags }}</p>
                      {% if page.header.rss_feed_preview_paragraphs == 'two' %}
                        <p>{{ secondParagraph | striptags }}</p>
                      {% endif %}
                      <p><a class="newwindow external-link" href="{{ item.url }}">Continue reading...</a></p><br>
                    {% endif %}
                  {% endif %}
                {% endfor %}
              {% endfor %}
            {% else %}
              {% for index, item in feed_items|sort_by_key('sortDate')|reverse %}
                  <h4>
                  <a class="newwindow external-link" href="{{ item.url }}">{{ item.title }}</a>
                  </h4>
                  <time>{{ item.date.date|date("m/d/Y") }}</time>, {{ item.retrievedTitle }}
                  {% if page.header.rss_feed_header_images and not (page.header.rss_feed_preview_paragraphs == 'all') %}
                    {% if grav.uri.param('chromeless') or (config.site.chromeless.enabled) %}
                        {% if not header.hide_rss_feed_header_images_when_chromeless %}
                          <p>{{ item.content|preg_get('/(<img(?:(\s*(class)\s*=\s*\x22([^\x22]+)\x22*)+|[^>]+?)*>)/') }}</p>
                        {% endif %}
                    {% else %}
                      <p>{{ item.content|preg_get('/(<img(?:(\s*(class)\s*=\s*\x22([^\x22]+)\x22*)+|[^>]+?)*>)/') }}</p>
                    {% endif %}
                  {% endif %}
                  {% set paragraphs = item.content | split('</p>') %}
                  {% set firstParagraph = paragraphs[0] ~ '</p>' %}
                  {% set secondParagraph = paragraphs[1] ~ '</p>' %}
                  {% if not (page.header.rss_feed_preview_paragraphs == 'none') %}
                    {% if page.header.rss_feed_preview_paragraphs == 'all' %}
                      {{ item.content }}
                    {% else %}
                      <p>{{ firstParagraph | striptags }}</p>
                      {% if page.header.rss_feed_preview_paragraphs == 'two' %}
                        <p>{{ secondParagraph | striptags }}</p>
                      {% endif %}
                      <p><a class="newwindow external-link" href="{{ item.url }}">Continue reading...</a></p><br>
                    {% endif %}
                  {% endif %}
                {% endfor %}
            {% endif %}
  	      {% else %}
            {% set admin_panel_appearance_url = grav.base_url ~ '/admin/plugins/twigfeeds' %}
            <a class="newwindow external-link" href="{{ admin_panel_appearance_url }}" title="Enable Twig Feeds Plugin">
            <i class="fa fa-cog" aria-hidden="true"></i>
            Enable and configure Twig Feeds Plugin</a> to display RSS Feeds on this page.
          {% endif %}

          {# Git repository edit link - hibbittsdesign.org #}
          {% if ( page.header.git_sync_repo_link_display is defined and page.header.git_sync_repo_link_display == 'page' ) or (( config.site.gitrepo.editlinklocation == 'page' and page.header.git_sync_repo_link_display is not defined ) and not (page.header.hide_git_sync_repo_link)) %}
            <hr>
            <br>
            {% include 'partials/gitrepo_link_note.html.twig' %}
            <br>
          {% endif %}
        </div>
        {# removed sidebar rendering - hibbittsdesign.org #}
      </div>
    </div>
  {% endblock %}

{% endembed %}
